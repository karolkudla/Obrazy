<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Symetryczne układy obrazów</title>
<style>
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#0d1020;color:#eee;display:flex;flex-direction:column;min-height:100vh}
  header{padding:12px 20px;background:#14182a;border-bottom:1px solid #262b43;position:sticky;top:0}
  header h1{font-size:16px;margin:0;font-weight:600}
  main{flex:1;display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px}
  @media(max-width:1000px){main{grid-template-columns:1fr}}
  .panel{background:#14182a;border:1px solid #262b43;border-radius:10px;padding:12px;overflow:auto}
  .panel h2{font-size:14px;margin:0 0 10px 0;color:#aaa}
  select,button{background:#0f1324;color:#eee;border:1px solid #333;border-radius:8px;padding:8px 10px;font-size:14px}
  button{cursor:pointer}
  .thumbs{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;max-height:320px;overflow:auto}
  .thumb{background:#0f1324;border:1px solid #333;border-radius:8px;padding:6px;cursor:pointer}
  .thumb canvas{width:100%;height:auto;display:block}
  .workspace{display:flex;flex-direction:column;gap:8px}
  canvas#main{background:#0b0f1f;border:1px dashed #444;border-radius:10px;display:block;max-width:100%}
  .tiny{font-size:12px;color:#aaa}
</style>
</head>
<body>
<header><h1>Symetryczne układy obrazów (50×70 cm)</h1></header>
<main>
  <section class="panel">
    <h2>Dostępne układy</h2>
    <select id="layoutSelect"></select>
    <div class="thumbs" id="thumbs"></div>
  </section>
  <section class="panel workspace">
    <div>
      <button id="resetBtn">Reset</button>
      <button id="rotateBtn">Obróć zaznaczony</button>
      <span class="tiny">Kliknij obraz, przeciągnij lub obróć</span>
    </div>
    <canvas id="main" width="720" height="310"></canvas>
  </section>
</main>

<script>
(function(){
  const FIELD_W=720, FIELD_H=310, GAP=5;
  const P={w:100,h:140}, L={w:140,h:100};
  const MIN=6;

  const layoutSelect=document.getElementById("layoutSelect");
  const thumbs=document.getElementById("thumbs");
  const canvas=document.getElementById("main");
  const ctx=canvas.getContext("2d");
  const resetBtn=document.getElementById("resetBtn");
  const rotateBtn=document.getElementById("rotateBtn");

  let layouts=[], currentId=null, rects=[], baseRects=[], selected=null;

  function rowWidth(seq){
    return seq.reduce((acc,ori)=>acc+(ori==='P'?P.w:L.w)+GAP, -GAP);
  }
  function rowHeight(ori){return ori==='P'?P.h:L.h;}

  // --- GENERATORY ---
  function generateGridLayouts(){
    let list=[],idc=0;
    for(const ori of ['P','L']){
      const size=(ori==='P'?P:L);
      const maxCols=Math.floor((FIELD_W+GAP)/(size.w+GAP));
      for(let cols=2;cols<=maxCols;cols++){
        for(let rows=1;rows<=3;rows++){
          const h=rows*size.h+(rows-1)*GAP;
          if(h>FIELD_H)continue;
          const count=cols*rows;
          if(count<MIN)continue;
          let rects=[];let y=(FIELD_H-h)/2;
          for(let r=0;r<rows;r++){
            const w=rowWidth(Array(cols).fill(ori));
            let x=(FIELD_W-w)/2;
            for(let c=0;c<cols;c++){
              rects.push({id:`r${r}_${c}`,x,y,w:size.w,h:size.h,ori});
              x+=size.w+GAP;
            }
            y+=size.h+GAP;
          }
          list.push({id:`G${idc++}`,desc:`Siatka ${rows}×${cols} ${ori}`,count,rects});
        }
      }
    }
    return list;
  }

  function generateMixRows(){
    let list=[],idc=0;
    const mixes=[['P','L'],['L','P']];
    mixes.forEach(seq=>{
      const h=rowHeight(seq[0])+rowHeight(seq[1])+GAP;
      if(h>FIELD_H)return;
      let rects=[];let y=(FIELD_H-h)/2;
      seq.forEach(ori=>{
        const size=(ori==='P'?P:L);
        const maxCols=Math.floor((FIELD_W+GAP)/(size.w+GAP));
        const cols=Math.max(2,maxCols-1);
        const w=rowWidth(Array(cols).fill(ori));
        let x=(FIELD_W-w)/2;
        for(let c=0;c<cols;c++){
          rects.push({id:`mix_${ori}_${c}_${y}`,x,y,w:size.w,h:size.h,ori});
          x+=size.w+GAP;
        }
        y+=size.h+GAP;
      });
      if(rects.length>=MIN){
        list.push({id:`M${idc++}`,desc:`Mix ${seq.join('+')}`,count:rects.length,rects});
      }
    });
    return list;
  }

  function generateSymPalindromes(){
    let list=[],idc=0;
    for(let len=3;len<=8;len++){ // długość rzędu
      const half=Math.floor(len/2);
      const isOdd=(len%2===1);
      const combos=Math.pow(2,half+(isOdd?1:0)); // wszystkie kombinacje P/L
      for(let mask=0;mask<combos;mask++){
        let seq=[];
        // lewa strona
        for(let i=0;i<half;i++){
          seq.push(((mask>>i)&1)?'P':'L');
        }
        // środek
        if(isOdd){
          seq.push(((mask>>half)&1)?'P':'L');
        }
        // prawa strona = lustrzane odbicie
        for(let i=half-1;i>=0;i--){
          seq.push(seq[i]);
        }
        const w=rowWidth(seq);
        if(w>FIELD_W)continue;
        let h=Math.max(...seq.map(o=>rowHeight(o)));
        if(h>FIELD_H)continue;
        if(seq.length<MIN)continue;
        let rects=[];let y=(FIELD_H-h)/2;let x=(FIELD_W-w)/2;
        seq.forEach((ori,idx)=>{
          const size=(ori==='P'?P:L);
          rects.push({id:`pal_${idc}_${idx}`,x,y,w:size.w,h:size.h,ori});
          x+=size.w+GAP;
        });
        list.push({id:`P${idc++}`,desc:`Palindrom ${seq.join('')}`,count:seq.length,rects});
      }
    }
    return list;
  }

  // --- RYSOWANIE ---
  function draw(){
    ctx.clearRect(0,0,FIELD_W,FIELD_H);
    ctx.fillStyle="#0b0f1f";ctx.fillRect(0,0,FIELD_W,FIELD_H);
    rects.forEach(r=>{
      ctx.fillStyle=(r.ori==='P'?"#2a3c7a":"#2a7a52");
      ctx.fillRect(r.x,r.y,r.w,r.h);
      ctx.strokeStyle=(r.id===selected?"#ffd166":"#444");
      ctx.lineWidth=2;ctx.strokeRect(r.x+0.5,r.y+0.5,r.w-1,r.h-1);
    });
  }

  function makeThumb(l){
    const TW=140,scale=TW/FIELD_W,TH=FIELD_H*scale;
    const c=document.createElement("canvas");c.width=TW;c.height=TH;const t=c.getContext("2d");
    t.fillStyle="#0b0f1f";t.fillRect(0,0,TW,TH);t.strokeStyle="#333";t.strokeRect(0.5,0.5,TW-1,TH-1);
    l.rects.forEach(r=>{t.fillStyle=(r.ori==='P'?"#2a3c7a":"#2a7a52");t.fillRect(r.x*scale,r.y*scale,r.w*scale,r.h*scale);});
    const wrap=document.createElement("div");wrap.className="thumb";wrap.appendChild(c);
    wrap.addEventListener("click",()=>{layoutSelect.value=l.id;loadLayout(l.id);});
    return wrap;
  }

  function loadLayout(id){
    const lay=layouts.find(l=>l.id===id);if(!lay)return;
    currentId=id;rects=lay.rects.map(r=>({...r}));baseRects=lay.rects.map(r=>({...r}));selected=null;draw();
  }

  // --- INTERAKCJE ---
  function hit(x,y){for(let i=rects.length-1;i>=0;i--){let r=rects[i];if(x>=r.x&&x<=r.x+r.w&&y>=r.y&&y<=r.y+r.h)return r.id;}return null;}
  let drag=null;
  canvas.addEventListener("mousedown",e=>{
    const r=canvas.getBoundingClientRect(),x=(e.clientX-r.left)*(canvas.width/r.width),y=(e.clientY-r.top)*(canvas.height/r.height);
    const id=hit(x,y);if(id){selected=id;const rr=rects.find(z=>z.id===id);drag={id,dx:x-rr.x,dy:y-rr.y};}else selected=null;draw();
  });
  window.addEventListener("mousemove",e=>{
    if(!drag)return;const r=canvas.getBoundingClientRect(),x=(e.clientX-r.left)*(canvas.width/r.width),y=(e.clientY-r.top)*(canvas.height/r.height);
    const rr=rects.find(z=>z.id===drag.id);if(!rr)return;rr.x=Math.max(0,Math.min(FIELD_W-rr.w,x-drag.dx));rr.y=Math.max(0,Math.min(FIELD_H-rr.h,y-drag.dy));draw();
  });
  window.addEventListener("mouseup",()=>drag=null);
  rotateBtn.addEventListener("click",()=>{
    if(!selected)return;const r=rects.find(z=>z.id===selected);if(!r)return;const cx=r.x+r.w/2,cy=r.y+r.h/2;const nw=r.h,nh=r.w;r.ori=(r.ori==='P'?'L':'P');r.w=nw;r.h=nh;r.x=Math.round(cx-nw/2);r.y=Math.round(cy-nh/2);draw();
  });
  resetBtn.addEventListener("click",()=>{if(!currentId)return;const lay=layouts.find(l=>l.id===currentId);rects=lay.rects.map(r=>({...r}));selected=null;draw();});

  // --- INIT ---
  function init(){
    layouts=[...generateGridLayouts(),...generateMixRows(),...generateSymPalindromes()];
    layoutSelect.innerHTML="";thumbs.innerHTML="";
    layouts.forEach(l=>{const o=document.createElement("option");o.value=l.id;o.textContent=`${l.desc} (${l.count})`;layoutSelect.appendChild(o);thumbs.appendChild(makeThumb(l));});
    if(layouts.length){layoutSelect.value=layouts[0].id;loadLayout(layouts[0].id);}
  }
  init();
})();
</script>
</body>
</html>
